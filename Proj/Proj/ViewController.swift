//
//  ViewController.swift
//  Proj
//
//  Created by Mac OS 12 on 2025/06/15.
//

import UIKit

class ViewController: UIViewController {
    @IBOutlet weak var nameTextField: UITextField!
    @IBOutlet weak var birthTextField: UITextField!
    @IBOutlet weak var resultLabel: UILabel!
    @IBOutlet weak var resultImageView: UIImageView!
    @IBOutlet weak var showResultButton: UIButton!
    
    let messages = [
        (1, 1, "타인과 자신을 용서하라. 과거의 사슬을 떨쳐내어 평화와 자유를 되찾으리니, 구원자는 자신임을 명심하라."),
        (2, 1, "변화를 두려워하지 말지어다. 그대는 무엇이든 될 수 있지만, 노력을 하지 않으면 무엇도 될 수 없음을 알라. 가능성을 향한 문을 닫아서는 아니 된다."),
        (3, 1, "있는 그대로의 자신을 받아들여라. 스스로를 존중하고 부족함마저 사랑할 때, 진정으로 타인을 사랑할 수 있게 되리니."),
        (4, 2, "더 오래 고민할수록, 더 적은 시간이 소비된다. 명심하라, 장고는 절대 악수를 부르지 않을 것이다."),
        (5, 2, "정답은 없다. 만물의 옳고 그름은 발자취가 결정한다. 의심하라. 세상, 주위, 스스로를 의심하라. 해답은 의심에서 비롯된다."),
        (6, 2, "결코 확신을 가지지 말라. 스스로가 틀렸을 가능성을 받아들이고, 다양한 관점을 탐구하라. 확신하는 정답은 오답이다."),
        (7, 3, "토대가 필요하리라. 세상은 언제나 그대를 시험할 지어니. 뿌리 깊은 나무는 흔들리지 않음을 명심하라. 폭풍이 다가오고 있다."),
        (8, 3, "과거는 현재에 대항하기 위해 존재. 모든 경우를 염두에 두고, 대비하라. 현실에 압도당할 때, 과거의 자신만이 그대를 구원한다."),
        (9, 3, "인간은 탐험가, 미래는 황금향. 당신은 현실의 바다를 항해하는 선장. 그대, 직시하라. 어수룩한 선장들의 말을 믿지 말고."),
        (10, 4, "행운에는 날개가 달렸음을 알지어다. 행운이 그대에게 머무는 순간은 잠시일 뿐, 그것이 언제까지고 곁에 있으리라 생각치 말라."),
        (11, 4, "마음을 굳게 다져야 한다. 실패해도 좌절치 말고, 두려워도 포기하지 말지니, 행운의 여신은 결국 그대에게 미소지으리라."),
        (12, 4, "행운은 준비된 사람에게 찾아온다. 그러므로 노력하고 겸손해야 한다. 오만한 자는 행운을 놓칠 것이다."),
        (13, 5, "그 어떤 명약이더라도 상처를 치유하려면 시간이 필요한 법. 그대 또한 그러하다. 이 또한 지나갈지니, 시간이야말로 만병통치약임을 알라."),
        (14, 5, "현실에 좌절되면 미래의 자신을 생각하라. 시간이 필요하지만 그것이 본질이다."),
        (15, 5, "시간이 모든 것을 치유할 것이다. 그러나 시간을 올바르게 활용하는 것이 진정한 치유의 비결이다. 모든 것은 당신의 손에 달려있음을."),
        (16, 6, "자신을 감추지 말라. 진정한 그대를 드러내고, 자신으로서 인정받을지어다. 자신을 감추는 것은 고립과 진배없음을 초래한다."),
        (17, 6, "스스로의 실수와 약점을 인정하고, 진솔하게 대면하라. 자신의 약함에 솔직해질 때, 그대는 진정으로 강해질 것이리라."),
        (18, 6, "못 다한 말이 있거든, 오늘이 기회임을 알라. 내일이 오리란 보장은 어디에도 없으니, 지금이 마지막 기회일 수 있다."),
        (19, 7, "인과를 주목하라. 세상 만물에는 시작이 있으니, 그대의 문제도 다르지 않다. 사족을 없애고 원인에 직면하면, 답을 찾을 것이다."),
        (20, 7, "내려놓는 법을 알아야 한다. 응어리를 내려놓고 문제를 다시 맞이해라. 그것은 놀랍게도 보잘것 없이 보일 것이다."),
        (21, 7, "완벽은 없다. 완벽하려 하면 더 멀어진다. 단순한 결과가 완벽에 더 가까울 때도 있다."),
        (22, 8, "일순의 나태가 그대의 결심을 무로 만들게 하지 말라. 마음은 곧 몸이요, 몸은 곧 마음이리니, 그대의 심신이 하나가 되도록 할지어다."),
        (23, 8, "첫 걸음을 내딛어라. 미시적이고 한미할지라도 좋다. 작고 구체적인 한 걸음을 정하라. 시작은 미약하지만 끝은 창대할 것이다."),
        (24, 8, "그대의 사고로 비롯된 창의성은, 행동하지 않으면 종말을 맞이하게 될 것이다. 나오지 못한 것은 의미를 가질 수 없으므로."),
        (25, 9, "그대를 압도하는 몰입의 파도에 삼켜질 것이리라. 그것은 위독한 맹독이요, 만병을 치료하는 영약일지니, 활용하는 것은 그대임을 명심하라."),
        (26, 9, "새로운 연을 만나게 될 것이다. 사람이든, 사물이든, 다른 것이든 상관없다. 그것은 크게 변화를 줄 것이니 열심히 하라."),
        (27, 9, "벗어나지 못하겠다면 받아들여라. 억누르지 말고 그대로 느껴라. 현실을 인정하는 게 나은 내일로 나아갈 첫걸음이 될 것이다."),
        (28, 10, "두려움을 모르면 용기도 없다. 그대야, 두려움을 직시하라. 공포를 눈을 돌리지 않는 것이 진정한 용기다."),
        (29, 10, "공포는 한 발짝 뒤에 있으나, 용기는 한 발짝 앞에 있음을 알라. 그대가 한 걸음을 내디딜 때, 용기는 그대의 곁에 있을 것이리라."),
        (30, 10, "실패는 약해지게 하는 것이 아니라 더 강해지게 만들어주는 도구임을 기억하라. 작은 용기로 거친 산도 넘을 수 있을 것이다."),
        (31, 11, "정체된 물처럼 영혼은 머무름에 갇히며 서서히 빛을 잃는다. 그러므로 안주하지 말고, 늘 새로운 가능성과 풍요로움을 기다려라."),
        (32, 11, "변화는 결코 한순간에 완성되지 아니하니, 작은 변화부터 시작하라. 오늘의 작은 선택이 새로운 나를 향한 초석이 될지어다."),
        (33, 11, "머무르지 말고 나아가라. 그대가 한 번의 시도와 열망을 품는 순간, 변화는 이미 시작되었음을 알게 되리라."),
        (34, 12, "기회는 항상 완벽하지 않다. 때로는 불확실하거나 어려운 도전이 올 수 있다. 가능성을 보고, 기회를 잡아 새로운 세계로 나아가라."),
        (35, 12, "머뭇거리는 동안, 기회는 흩날리는 꽃잎처럼 사리지리라. 지금이 그 순간임을 알고 손을 뻗으라. 기회는 기다리지 않는다."),
        (36, 12, "망설이지 말지어다. 그대가 지금 눈앞에 선 기회를 망설임으로 놓친다면, 그것은 바람처럼 지나가 다시는 그대의 손길에 닿지 않으리라."),
        (37, 13, "그대가 오늘을 살아갈 힘은 과거가 아닌 현재에 있음을 알라. 과거란 그림자와 같으니, 이를 붙잡는 손에는 공허함만 남을 뿐이리라."),
        (38, 13, "삶은 강물처럼 흐르니 물결을 타고 흘러가라. 미래는 앞으로 펼쳐진 넓은 바다다."),
        (39, 13, "과거의 아픔으로부터 자유로워져라. 실패는 그대를 정의하지 않고, 과거의 실수는 오늘의 지혜로, 상처는 내일을 위한 힘으로 변해야 한다."),
        (40, 14, "성찰은 강함을 발견하는 과정이다. 과거 선택과 행동을 직시하라. 성공은 겸손한 감사, 실패는 값진 교훈으로 받아들여 빛을 발할 것이다."),
        (41, 14, "진실한 자아를 마주하라. 외부의 아닌 내부적인 자아를 직시하라. 마음 깊은 곳에 소망이 존재한다."),
        (42, 14, "성찰은 멈춤이 아닌 새로운 시작임을 명심하라. 자신을 돌아볼 때마다, 그대는 성장하고, 더 나은 방향으로 나아갈 준비를 갖추게 되리라."),
        (43, 15, "삶의 어두운 순간에도 빛이 있다. 흔들릴지라도, 의지만 있다면 길을 비추리라. 실패가 짓누른다 해도, 단련하고 강하게 만들 것이다."),
        (44, 15, "역경을 마주하여도 발걸음은 멈추지 말라. 그 길 끝에서, 그대는 스스로를 더 강인하고 찬란한 모습으로 만나게 되리라."),
        (45, 15, "바람은 때로 도와주고, 때로 방해하기도 한다. 역경도 성장의 기회일 뿐. 굴복할지, 극복할지는 네 선택이다."),
        (46, 16, "삶은 책이 아니다. 상상 속에 머물러선 진실을 알 수 없다. 그대여, 경험하라. 경험 없이는 진정한 성장이 없을 것이다."),
        (47, 16, "세계에 도전하라. 익숙함을 뛰어넘고, 두려움을 극복하라. 새로운 환경과 사람, 낯선 길에서 내면의 힘을 발견하게 될 것이다."),
        (48, 16, "삶의 크고 작은 모든 순간에서 배움을 추구하라. 성공의 환희 속에서도, 실패의 아픔 속에서도 그대는 항상 배우고 있음을 기억하라."),
        (49, 17, "무지는 악이 아님을 명심하라. 진정으로 중요한 것은, 무엇을 알고 무엇을 모를 것인가를 지혜롭게 선택하는 것일지어다."),
        (50, 17, "가끔은 모르는 게 좋을 때도 있다. 지나치게 살펴보면 불안과 후회의 원인이 될 수 있다. 비밀은 그 이유가 있어서 숨겨져 있는 것이니."),
        (51, 17, "너무 알려고 하면 호기심을 잃게 된다. 진실도 빛을 잃게 되는 법. 모르는 게 괜찮을 때, 삶은 가능성과 신비로 가득하다."),
        (52, 18, "더 큰 굴곡과 후회의 샛길을 알아라. 얕은 노력은 모래성처럼 허물어지고, 나무처럼 흔들리기 쉽다."),
        (53, 18, "정직한 노력과 꾸준함으로 길을 가라. 고통과 인내는 헛되지 않으며, 돌아볼 때 그 길이 가장 값진 재산이 될 것이다."),
        (54, 18, "힘든 길일수록 발걸음은 더욱 굳건해져. 고난 끝에 얻은 지혜와 경험은 삶을 더 깊고 풍요롭게 만들 것이다."),
        (55, 19, "넘어지지 않을 내면의 힘을 길러라. 문제는 예기치 못한 순간에 찾아오나, 준비된 마음을 가진 사람에게는 위험이 되지 않을 것이다."),
        (56, 19, "문제는 결코 영원하지 않다. 고로 그대, 포기하지 말지어다. 세상의 모든 문제는 그대의 인내와 끈기 앞에서 물러가리라."),
        (57, 19, "홀로 모든 것을 짊어지려 하지 말지어다. 신뢰할 이들과 함께하라. 그들의 지혜와 손길이 그대의 짐을 덜어주리라."),
        (58, 20, "말은 화살처럼 한 번 내뱉으면 돌이킬 수 없다. 상처를 남기거나 흔적을 남길 수 있음을 명심하라."),
        (59, 20, "생각과 마음을 비추는 거울이 말이다. 말을 조심하라. 경솔한 말은 가벼워 보이지만, 때로는 큰 문제를 일으킬 수 있다."),
        (60, 20, "그 말은 날카롭게 하지 않아도 된다. 진실을 말하되, 배려는 잊지 말아야 한다. 말의 힘은 큰 소리가 아니라 진심에서 나오는 것이다."),
        (61, 21, "버림은 비움이 아니라 채움일지니, 미련을 버리고 꿈과 희망으로 채우라. 그대의 미래는 과거보다 넓고 빛나는 가능성으로 가득하다."),
        (62, 21, "과거 순간들은 당신을 형성하지만 미래를 결정하지 않는다. 가치는 실패나 상실에 좌우되지 않으므로."),
        (63, 21, "후회와 아쉬움에도 배울 점이 있음을 인지하고, 교훈으로 삼아 같은 실수를 막도록 노력하라. 과거는 최고의 스승이라는 것을 명심하라."),
        (64, 22, "넘어짐은 종료가 아닌 쉼표임을 알라. 길은 여전히 그대를 기다리고 있을지니, 쉼표는 하이라이트를 향한 전주에 불과하다."),
        (65, 22, "넘어짐을 두려워 말지어다. 시도하지 않는 자는 앞으로 나아갈 수 없다. 실패는 힘을 증명하는 기회, 넘어짐은 용기를 시험하는 순간이다."),
        (66, 22, "일어서는 의지가 가치를 증명하리니, 더 강인하게 일어서라. 중요한 것은 넘어진 횟수가 아니라, 이기고 나아가는 발걸음이다."),
        (67, 23, "가능성이란 동틀 녘의 태양과 같다. 처음에는 어둠 속에 가리우지만, 그대가 한 걸음 더 나아갈 때 비로소 그 빛을 드러내리라."),
        (68, 23, "낯섬 속에 가능성이 숨겨져 있으니, 새로운 인연과 환경을 거부하지 말라. 인연의 실타래는 그대의 뜻을 넘어 더 큰 미래를 엮어주리니."),
        (69, 23, "발걸음을 멈추지 말라. 세상은 열린 마음으로 나아가는 사람에게 끝이 없는 길을 열어준다. 그대의 가능성은 더 넓고 찬란할 것이다."),
        (70, 24, "시련 속에서 배우고 깨달은 것들은 그대의 가장 값진 자산이 되리니, 위기의 순간에 무엇을 배우고 어떻게 성장할지를 고민하라."),
        (71, 24, "위기란 새로운 길이 열리는 신호다. 불꽃이 쇠를 단련하듯, 시련은 그대를 더욱 강하고 견고하게 만들어주리라."),
        (72, 24, "위기의 때야말로 결단과 용기가 필요하다. 문제를 피하지 말고 정면으로 맞서라. 그대의 한걸음이 문제를 돌파하는 시작이 되리라."),
        (73, 25, "모든 일이 흐름이 있고, 만물은 각자의 때를 기다려 자라난다. 주위를 살피며 시간을 지켜라. 결과가 역행할지도 모른다는 걸 명심하라."),
        (74, 25, "때가 무르익지 않았을 때의 행동은, 벼가 익기도 전에 수확하는 것과 같다. 서두름과 욕심은 좌절과 소진만을 남길지어다."),
        (75, 25, "시간은 준비된 자를 배신하지 않으리라. 그대가 지혜롭게 기다리고 단단히 준비한다면, 그대의 때가 왔을 때 그 누구보다도 빛날 것이다."),
        (76, 26, "좌절하지 말아라. 오늘의 불행은 내일의 행운이 될 지어니.방심하지 말아라. 성공과 실패는 동전의 양면과도 같으니."),
        (77, 26, "영원한 밤은 없어. 오늘 어둠은 내일 빛의 초석. 닭의 목을 비틀어도 새벽이 옴을 기억하라. 곧 그대의 여명이다."),
        (78, 26, "만물에는 빛과 어둠이 공존한다. 그러니 명심하라. 그것이 빛이 될지, 어둠이 될지는 그대의 손에 달려있음을."),
        (79, 27, "조급함은 마음을 어지럽히고 걸음을 흔들 뿐이다. 때와 흐름을 알아야 한다. 조급함은 기회를 놓치게 할 뿐이다."),
        (80, 27, "조급함은 시야를 좁히고 중요한 것을 볼 수 없게 만든다. 여정은 속도가 아닌 방향에 달려 있으니 목적지가 발걸음의 끝에 있다고 믿어라."),
        (81, 27, "다른 사람과 비교하지 말고, 각자의 시간과 속도를 인정하며 나아가라. 자신의 길은 자신만의 걸음으로 이뤄져야 한다."),
        (82, 28, "겸손은 그대의 가치를 낮추는 것이 아닌, 깊이를 더하는 미덕이리니, 겸허함 속에서 더 큰 신뢰와 존경을 얻을지어다."),
        (83, 28, "배울 여지를 남기는 자만이 겸손할 수 있다. 교만은 마음을 닫고 고립시키지만, 겸손은 세상과 지혜를 불러들인다."),
        (84, 28, "다른 사람의 빛을 가리우지 말고 함께 한 이들을 존중하고 가치를 인정하라. 진정한 위대함은 타인을 빛나게 하는 것이다."),
        (85, 29, "부정이 스며들 때, 의식적으로 생각의 반대편을 바라봐라. 절망 속에서도 희망을 찾아, 마음의 주인은 자신임을 명심하라."),
        (86, 29, "과거 후회나 미래 두려움에서 비관적 생각이 시작된다. 현재에 집중해라. 당신이 할 수 있는 일에 집중하면 어둠이 사라질 것이다."),
        (87, 29, "부정적인 말을 입에 올리지 말라. 그대의 언어는 생각을 키우고, 그 생각은 행동을 결정하리니, 스스로에게 긍정의 말을 들려주어라."),
        (88, 30, "고난은 당신을 무너뜨리려는 게 아니다. 의지를 시험하고 용기를 깨우는 것이다. 힘들어도 한 발씩 나아가면 끝을 본다."),
        (89, 30, "스스로를 믿는 자는 결국 이겨내리라. 과거를 회상하며 자신감을 갖자. 이미 많은 어려움을 극복했으니 이번에도 괜찮을 것이다."),
        (90, 30, "절망의 순간에도 희망의 끈을 놓지 말라. 어둠이 깊을수록 새벽은 가까운 법. 그대의 마음에 희망을 품고, 그대를 이끌게 할지어다."),
        (91, 31, "실행을 꺼리는 이유는 완벽하지 못할까 하는 두려움 때문이다. 그대, 명심할지어다. 완벽은 행동 중에서 형성된다."),
        (92, 31, "걱정은 미지에 대한 두려움의 그림자뿐. 한 걸음 내딛으면 그림자는 없어지고 현실은 변할 것이다."),
        (93, 31, "걱정하며 멈출 때는 길이 안 보이지만, 움직이는 사람은 길을 찾을 것이다. 작은 행동이 기회를 만들어주고 불안을 해소해줄 것이다."),
        (94, 32, "나약함은 그대 본성이 아니다. 그대 속에는 누구도 빼앗을 수 없는 강인함이 숨어 있고, 그것을 발견하면 다시 일어날 힘을 얻게 된다."),
        (95, 32, "큰 걸음을 내딛기 힘들다면, 작고 사소한 목표부터 이루어라. 작은 성취는 나약함을 밀어내고, 다시 나아갈 힘과 용기를 불어넣으리라."),
        (96, 32, "지친 몸과 마음은 나약함을 불러들이는 법. 그대의 몸과 정신에 휴식을 줄지어다. 다시 일어설 힘은 평온 속에 깃들지어니."),
        (97, 33, "현실을 직시하라. 부족함을 감추지 말고, 실패를 피하지 말라. 인정하면 문제를 이해할 수 있을 것이다."),
        (98, 33, "인정은 더 나아가겠다는 결심이자, 스스로를 단단하게 세우는 첫걸음이다. 부족함을 인정하고 나아가면 더 큰 성장과 가능성이 열릴 것이다."),
        (99, 33, "더 나은 내일을 맞이할 수 있다. 약함을 숨기지 말고, 진실을 직시하라. 그럼 더 강인한 모습으로 다시 일어날 수 있을 것이다."),
        (100, 34, "기억하라, 후회는 족쇄가 아닌 교훈이다. 후회는 자신을 비추는 거울이며 스스로를 찾을 기회이다."),
        (101, 34, "후회하지 말고 자신을 탓하지 말아라. 완벽한 사람은 없고, 모두가 실수한다. 과거를 용서하면 새로운 미래가 열린다.")
    ]
    
    @IBAction func showResultButtonTapped(_ sender: UIButton) {
        guard let name = nameTextField.text, !name.isEmpty,
                  let birth = birthTextField.text, !birth.isEmpty else {
                resultLabel.text = "이름과 생년월일을 모두 입력해주세요."
                resultImageView.image = nil
                return
            }
        
        // 1. 이름 유니코드 합
        let nameSum = name.unicodeScalars.reduce(0) { $0 + Int($1.value) }

        // 2. 생일 숫자 합
        let birthDigits = birth.filter { $0.isNumber }
        let birthSum = birthDigits.reduce(0) { $0 + Int(String($1))! }

        // 3. 오늘 날짜를 yyyyMMdd 형식으로 만들기
        let dateFormatter = DateFormatter()
        dateFormatter.dateFormat = "yyyyMMdd"
        let todayString = dateFormatter.string(from: Date()) // 예: "20250615"

        // 4. 오늘 날짜 숫자 합
        let todayDigits = todayString.filter { $0.isNumber }
        let todaySum = todayDigits.reduce(0) { $0 + Int(String($1))! }

        // 5. 총합 계산
        let total = nameSum + birthSum + todaySum

        let index = total % messages.count
        let result = messages[index]

        resultLabel.text = result.2
        loadImage(from: "https://ocbgame.okcashbag.com/files/ocbgame/16/sns/"+String(result.0)+"."+String(result.1 % 3)+".webp");
    }
    
    func loadImage(from urlString: String) {
        guard let url = URL(string: urlString) else {
            print("잘못된 URL")
            return
        }

        // 백그라운드 스레드에서 이미지 다운로드
        URLSession.shared.dataTask(with: url) { data, response, error in
            if let error = error {
                print("이미지 다운로드 에러: \(error)")
                return
            }

            guard let data = data, let image = UIImage(data: data) else {
                print("이미지 데이터 오류")
                return
            }

            // 메인 스레드에서 이미지뷰에 적용
            DispatchQueue.main.async {
                self.resultImageView.image = image
            }
        }.resume()
    }

    override func viewDidLoad() {
        super.viewDidLoad()
        setupDatePicker()
        
        // 텍스트필드 테두리 스타일 지정
       nameTextField.layer.borderWidth = 1
       nameTextField.layer.borderColor = UIColor.gray.cgColor
       nameTextField.layer.cornerRadius = 5
       nameTextField.backgroundColor = UIColor(white: 0.95, alpha: 1)  // 약간 회색 배경
       
       birthTextField.layer.borderWidth = 1
       birthTextField.layer.borderColor = UIColor.gray.cgColor
       birthTextField.layer.cornerRadius = 5
       birthTextField.backgroundColor = UIColor(white: 0.95, alpha: 1)
        
    showResultButton.layer.cornerRadius = 8
    showResultButton.backgroundColor = UIColor.systemBlue
    showResultButton.setTitleColor(.white, for: .normal)
        
    }

    func setupDatePicker() {
        let datePicker = UIDatePicker()
        datePicker.datePickerMode = .date
        datePicker.preferredDatePickerStyle = .wheels // iOS 14+이면 wheels 스타일
        datePicker.locale = Locale(identifier: "ko_KR") // 한국식

        // 날짜가 바뀔 때마다 birthTextField 텍스트를 업데이트
        datePicker.addTarget(self, action: #selector(dateChanged(_:)), for: .valueChanged)

        // 텍스트필드 입력 뷰를 datePicker로 설정
        birthTextField.inputView = datePicker

        // 도구모음 (완료 버튼 추가)
        let toolbar = UIToolbar()
        toolbar.sizeToFit()

        let doneButton = UIBarButtonItem(title: "완료", style: .done, target: self, action: #selector(dismissDatePicker))
        toolbar.setItems([doneButton], animated: true)

        birthTextField.inputAccessoryView = toolbar
    }
    
    @objc func dateChanged(_ sender: UIDatePicker) {
        let formatter = DateFormatter()
        formatter.dateFormat = "yyyyMMdd" // 숫자합에 쓰기 좋은 포맷
        birthTextField.text = formatter.string(from: sender.date)
    }

    @objc func dismissDatePicker() {
        view.endEditing(true)
    }
    
}
